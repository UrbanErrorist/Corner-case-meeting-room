{"ast":null,"code":"/*!\r\n * https://github.com/Starcounter-Jack/JSON-Patch\r\n * (c) 2017 Joachim Wester\r\n * MIT license\r\n */\nvar helpers_1 = require('./helpers');\n\nvar core_1 = require('./core');\n/* export all core functions */\n\n\nvar core_2 = require('./core');\n\nexports.applyOperation = core_2.applyOperation;\nexports.applyPatch = core_2.applyPatch;\nexports.applyReducer = core_2.applyReducer;\nexports.getValueByPointer = core_2.getValueByPointer;\nexports.validate = core_2.validate;\nexports.validator = core_2.validator;\n/* export some helpers */\n\nvar helpers_2 = require('./helpers');\n\nexports.JsonPatchError = helpers_2.PatchError;\nexports.deepClone = helpers_2._deepClone;\nexports.escapePathComponent = helpers_2.escapePathComponent;\nexports.unescapePathComponent = helpers_2.unescapePathComponent;\nvar beforeDict = new WeakMap();\n\nvar Mirror = function () {\n  function Mirror(obj) {\n    this.observers = new Map();\n    this.obj = obj;\n  }\n\n  return Mirror;\n}();\n\nvar ObserverInfo = function () {\n  function ObserverInfo(callback, observer) {\n    this.callback = callback;\n    this.observer = observer;\n  }\n\n  return ObserverInfo;\n}();\n\nfunction getMirror(obj) {\n  return beforeDict.get(obj);\n}\n\nfunction getObserverFromMirror(mirror, callback) {\n  return mirror.observers.get(callback);\n}\n\nfunction removeObserverFromMirror(mirror, observer) {\n  mirror.observers.delete(observer.callback);\n}\n/**\r\n * Detach an observer from an object\r\n */\n\n\nfunction unobserve(root, observer) {\n  observer.unobserve();\n}\n\nexports.unobserve = unobserve;\n/**\r\n * Observes changes made to an object, which can then be retrieved using generate\r\n */\n\nfunction observe(obj, callback) {\n  var patches = [];\n  var observer;\n  var mirror = getMirror(obj);\n\n  if (!mirror) {\n    mirror = new Mirror(obj);\n    beforeDict.set(obj, mirror);\n  } else {\n    var observerInfo = getObserverFromMirror(mirror, callback);\n    observer = observerInfo && observerInfo.observer;\n  }\n\n  if (observer) {\n    return observer;\n  }\n\n  observer = {};\n  mirror.value = helpers_1._deepClone(obj);\n\n  if (callback) {\n    observer.callback = callback;\n    observer.next = null;\n\n    var dirtyCheck = function dirtyCheck() {\n      generate(observer);\n    };\n\n    var fastCheck = function fastCheck() {\n      clearTimeout(observer.next);\n      observer.next = setTimeout(dirtyCheck);\n    };\n\n    if (typeof window !== 'undefined') {\n      if (window.addEventListener) {\n        window.addEventListener('mouseup', fastCheck);\n        window.addEventListener('keyup', fastCheck);\n        window.addEventListener('mousedown', fastCheck);\n        window.addEventListener('keydown', fastCheck);\n        window.addEventListener('change', fastCheck);\n      } else {\n        document.documentElement.attachEvent('onmouseup', fastCheck);\n        document.documentElement.attachEvent('onkeyup', fastCheck);\n        document.documentElement.attachEvent('onmousedown', fastCheck);\n        document.documentElement.attachEvent('onkeydown', fastCheck);\n        document.documentElement.attachEvent('onchange', fastCheck);\n      }\n    }\n  }\n\n  observer.patches = patches;\n  observer.object = obj;\n\n  observer.unobserve = function () {\n    generate(observer);\n    clearTimeout(observer.next);\n    removeObserverFromMirror(mirror, observer);\n\n    if (typeof window !== 'undefined') {\n      if (window.removeEventListener) {\n        window.removeEventListener('mouseup', fastCheck);\n        window.removeEventListener('keyup', fastCheck);\n        window.removeEventListener('mousedown', fastCheck);\n        window.removeEventListener('keydown', fastCheck);\n      } else {\n        document.documentElement.detachEvent('onmouseup', fastCheck);\n        document.documentElement.detachEvent('onkeyup', fastCheck);\n        document.documentElement.detachEvent('onmousedown', fastCheck);\n        document.documentElement.detachEvent('onkeydown', fastCheck);\n      }\n    }\n  };\n\n  mirror.observers.set(callback, new ObserverInfo(callback, observer));\n  return observer;\n}\n\nexports.observe = observe;\n/**\r\n * Generate an array of patches from an observer\r\n */\n\nfunction generate(observer) {\n  var mirror = beforeDict.get(observer.object);\n\n  _generate(mirror.value, observer.object, observer.patches, \"\");\n\n  if (observer.patches.length) {\n    core_1.applyPatch(mirror.value, observer.patches);\n  }\n\n  var temp = observer.patches;\n\n  if (temp.length > 0) {\n    observer.patches = [];\n\n    if (observer.callback) {\n      observer.callback(temp);\n    }\n  }\n\n  return temp;\n}\n\nexports.generate = generate; // Dirty check if obj is different from mirror, generate patches and update mirror\n\nfunction _generate(mirror, obj, patches, path) {\n  if (obj === mirror) {\n    return;\n  }\n\n  if (typeof obj.toJSON === \"function\") {\n    obj = obj.toJSON();\n  }\n\n  var newKeys = helpers_1._objectKeys(obj);\n\n  var oldKeys = helpers_1._objectKeys(mirror);\n\n  var changed = false;\n  var deleted = false; //if ever \"move\" operation is implemented here, make sure this test runs OK: \"should not generate the same patch twice (move)\"\n\n  for (var t = oldKeys.length - 1; t >= 0; t--) {\n    var key = oldKeys[t];\n    var oldVal = mirror[key];\n\n    if (helpers_1.hasOwnProperty(obj, key) && !(obj[key] === undefined && oldVal !== undefined && Array.isArray(obj) === false)) {\n      var newVal = obj[key];\n\n      if (typeof oldVal == \"object\" && oldVal != null && typeof newVal == \"object\" && newVal != null) {\n        _generate(oldVal, newVal, patches, path + \"/\" + helpers_1.escapePathComponent(key));\n      } else {\n        if (oldVal !== newVal) {\n          changed = true;\n          patches.push({\n            op: \"replace\",\n            path: path + \"/\" + helpers_1.escapePathComponent(key),\n            value: helpers_1._deepClone(newVal)\n          });\n        }\n      }\n    } else if (Array.isArray(mirror) === Array.isArray(obj)) {\n      patches.push({\n        op: \"remove\",\n        path: path + \"/\" + helpers_1.escapePathComponent(key)\n      });\n      deleted = true; // property has been deleted\n    } else {\n      patches.push({\n        op: \"replace\",\n        path: path,\n        value: obj\n      });\n      changed = true;\n    }\n  }\n\n  if (!deleted && newKeys.length == oldKeys.length) {\n    return;\n  }\n\n  for (var t = 0; t < newKeys.length; t++) {\n    var key = newKeys[t];\n\n    if (!helpers_1.hasOwnProperty(mirror, key) && obj[key] !== undefined) {\n      patches.push({\n        op: \"add\",\n        path: path + \"/\" + helpers_1.escapePathComponent(key),\n        value: helpers_1._deepClone(obj[key])\n      });\n    }\n  }\n}\n/**\r\n * Create an array of patches from the differences in two objects\r\n */\n\n\nfunction compare(tree1, tree2) {\n  var patches = [];\n\n  _generate(tree1, tree2, patches, '');\n\n  return patches;\n}\n\nexports.compare = compare;","map":{"version":3,"sources":["/Users/blackhat/TV Shows/Meeting Room/src/frontend/node_modules/fast-json-patch/lib/duplex.js"],"names":["helpers_1","require","core_1","core_2","exports","applyOperation","applyPatch","applyReducer","getValueByPointer","validate","validator","helpers_2","JsonPatchError","PatchError","deepClone","_deepClone","escapePathComponent","unescapePathComponent","beforeDict","WeakMap","Mirror","obj","observers","Map","ObserverInfo","callback","observer","getMirror","get","getObserverFromMirror","mirror","removeObserverFromMirror","delete","unobserve","root","observe","patches","set","observerInfo","value","next","dirtyCheck","generate","fastCheck","clearTimeout","setTimeout","window","addEventListener","document","documentElement","attachEvent","object","removeEventListener","detachEvent","_generate","length","temp","path","toJSON","newKeys","_objectKeys","oldKeys","changed","deleted","t","key","oldVal","hasOwnProperty","undefined","Array","isArray","newVal","push","op","compare","tree1","tree2"],"mappings":"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","sourcesContent":["/*!\r\n * https://github.com/Starcounter-Jack/JSON-Patch\r\n * (c) 2017 Joachim Wester\r\n * MIT license\r\n */\r\nvar helpers_1 = require('./helpers');\r\nvar core_1 = require('./core');\r\n/* export all core functions */\r\nvar core_2 = require('./core');\r\nexports.applyOperation = core_2.applyOperation;\r\nexports.applyPatch = core_2.applyPatch;\r\nexports.applyReducer = core_2.applyReducer;\r\nexports.getValueByPointer = core_2.getValueByPointer;\r\nexports.validate = core_2.validate;\r\nexports.validator = core_2.validator;\r\n/* export some helpers */\r\nvar helpers_2 = require('./helpers');\r\nexports.JsonPatchError = helpers_2.PatchError;\r\nexports.deepClone = helpers_2._deepClone;\r\nexports.escapePathComponent = helpers_2.escapePathComponent;\r\nexports.unescapePathComponent = helpers_2.unescapePathComponent;\r\nvar beforeDict = new WeakMap();\r\nvar Mirror = (function () {\r\n    function Mirror(obj) {\r\n        this.observers = new Map();\r\n        this.obj = obj;\r\n    }\r\n    return Mirror;\r\n}());\r\nvar ObserverInfo = (function () {\r\n    function ObserverInfo(callback, observer) {\r\n        this.callback = callback;\r\n        this.observer = observer;\r\n    }\r\n    return ObserverInfo;\r\n}());\r\nfunction getMirror(obj) {\r\n    return beforeDict.get(obj);\r\n}\r\nfunction getObserverFromMirror(mirror, callback) {\r\n    return mirror.observers.get(callback);\r\n}\r\nfunction removeObserverFromMirror(mirror, observer) {\r\n    mirror.observers.delete(observer.callback);\r\n}\r\n/**\r\n * Detach an observer from an object\r\n */\r\nfunction unobserve(root, observer) {\r\n    observer.unobserve();\r\n}\r\nexports.unobserve = unobserve;\r\n/**\r\n * Observes changes made to an object, which can then be retrieved using generate\r\n */\r\nfunction observe(obj, callback) {\r\n    var patches = [];\r\n    var observer;\r\n    var mirror = getMirror(obj);\r\n    if (!mirror) {\r\n        mirror = new Mirror(obj);\r\n        beforeDict.set(obj, mirror);\r\n    }\r\n    else {\r\n        var observerInfo = getObserverFromMirror(mirror, callback);\r\n        observer = observerInfo && observerInfo.observer;\r\n    }\r\n    if (observer) {\r\n        return observer;\r\n    }\r\n    observer = {};\r\n    mirror.value = helpers_1._deepClone(obj);\r\n    if (callback) {\r\n        observer.callback = callback;\r\n        observer.next = null;\r\n        var dirtyCheck = function () {\r\n            generate(observer);\r\n        };\r\n        var fastCheck = function () {\r\n            clearTimeout(observer.next);\r\n            observer.next = setTimeout(dirtyCheck);\r\n        };\r\n        if (typeof window !== 'undefined') {\r\n            if (window.addEventListener) {\r\n                window.addEventListener('mouseup', fastCheck);\r\n                window.addEventListener('keyup', fastCheck);\r\n                window.addEventListener('mousedown', fastCheck);\r\n                window.addEventListener('keydown', fastCheck);\r\n                window.addEventListener('change', fastCheck);\r\n            }\r\n            else {\r\n                document.documentElement.attachEvent('onmouseup', fastCheck);\r\n                document.documentElement.attachEvent('onkeyup', fastCheck);\r\n                document.documentElement.attachEvent('onmousedown', fastCheck);\r\n                document.documentElement.attachEvent('onkeydown', fastCheck);\r\n                document.documentElement.attachEvent('onchange', fastCheck);\r\n            }\r\n        }\r\n    }\r\n    observer.patches = patches;\r\n    observer.object = obj;\r\n    observer.unobserve = function () {\r\n        generate(observer);\r\n        clearTimeout(observer.next);\r\n        removeObserverFromMirror(mirror, observer);\r\n        if (typeof window !== 'undefined') {\r\n            if (window.removeEventListener) {\r\n                window.removeEventListener('mouseup', fastCheck);\r\n                window.removeEventListener('keyup', fastCheck);\r\n                window.removeEventListener('mousedown', fastCheck);\r\n                window.removeEventListener('keydown', fastCheck);\r\n            }\r\n            else {\r\n                document.documentElement.detachEvent('onmouseup', fastCheck);\r\n                document.documentElement.detachEvent('onkeyup', fastCheck);\r\n                document.documentElement.detachEvent('onmousedown', fastCheck);\r\n                document.documentElement.detachEvent('onkeydown', fastCheck);\r\n            }\r\n        }\r\n    };\r\n    mirror.observers.set(callback, new ObserverInfo(callback, observer));\r\n    return observer;\r\n}\r\nexports.observe = observe;\r\n/**\r\n * Generate an array of patches from an observer\r\n */\r\nfunction generate(observer) {\r\n    var mirror = beforeDict.get(observer.object);\r\n    _generate(mirror.value, observer.object, observer.patches, \"\");\r\n    if (observer.patches.length) {\r\n        core_1.applyPatch(mirror.value, observer.patches);\r\n    }\r\n    var temp = observer.patches;\r\n    if (temp.length > 0) {\r\n        observer.patches = [];\r\n        if (observer.callback) {\r\n            observer.callback(temp);\r\n        }\r\n    }\r\n    return temp;\r\n}\r\nexports.generate = generate;\r\n// Dirty check if obj is different from mirror, generate patches and update mirror\r\nfunction _generate(mirror, obj, patches, path) {\r\n    if (obj === mirror) {\r\n        return;\r\n    }\r\n    if (typeof obj.toJSON === \"function\") {\r\n        obj = obj.toJSON();\r\n    }\r\n    var newKeys = helpers_1._objectKeys(obj);\r\n    var oldKeys = helpers_1._objectKeys(mirror);\r\n    var changed = false;\r\n    var deleted = false;\r\n    //if ever \"move\" operation is implemented here, make sure this test runs OK: \"should not generate the same patch twice (move)\"\r\n    for (var t = oldKeys.length - 1; t >= 0; t--) {\r\n        var key = oldKeys[t];\r\n        var oldVal = mirror[key];\r\n        if (helpers_1.hasOwnProperty(obj, key) && !(obj[key] === undefined && oldVal !== undefined && Array.isArray(obj) === false)) {\r\n            var newVal = obj[key];\r\n            if (typeof oldVal == \"object\" && oldVal != null && typeof newVal == \"object\" && newVal != null) {\r\n                _generate(oldVal, newVal, patches, path + \"/\" + helpers_1.escapePathComponent(key));\r\n            }\r\n            else {\r\n                if (oldVal !== newVal) {\r\n                    changed = true;\r\n                    patches.push({ op: \"replace\", path: path + \"/\" + helpers_1.escapePathComponent(key), value: helpers_1._deepClone(newVal) });\r\n                }\r\n            }\r\n        }\r\n        else if (Array.isArray(mirror) === Array.isArray(obj)) {\r\n            patches.push({ op: \"remove\", path: path + \"/\" + helpers_1.escapePathComponent(key) });\r\n            deleted = true; // property has been deleted\r\n        }\r\n        else {\r\n            patches.push({ op: \"replace\", path: path, value: obj });\r\n            changed = true;\r\n        }\r\n    }\r\n    if (!deleted && newKeys.length == oldKeys.length) {\r\n        return;\r\n    }\r\n    for (var t = 0; t < newKeys.length; t++) {\r\n        var key = newKeys[t];\r\n        if (!helpers_1.hasOwnProperty(mirror, key) && obj[key] !== undefined) {\r\n            patches.push({ op: \"add\", path: path + \"/\" + helpers_1.escapePathComponent(key), value: helpers_1._deepClone(obj[key]) });\r\n        }\r\n    }\r\n}\r\n/**\r\n * Create an array of patches from the differences in two objects\r\n */\r\nfunction compare(tree1, tree2) {\r\n    var patches = [];\r\n    _generate(tree1, tree2, patches, '');\r\n    return patches;\r\n}\r\nexports.compare = compare;\r\n"]},"metadata":{},"sourceType":"script"}